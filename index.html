<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≤ng Xoay May M·∫Øn - IPC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            /* N·ªÄN H√åNH ·∫¢NH */
            background-image: url('background.jpg');
            background-size: 115%;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        /* ANIMATED DOTS PATTERN - ·∫®N ƒë·ªÉ hi·ªán n·ªÅn ·∫£nh */
        body::before {
            display: none; /* T·∫Øt ƒë·ªÉ hi·ªán n·ªÅn ·∫£nh */
        }

        @keyframes movePattern {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        body.fullscreen {
            padding: 0;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            transition: all 0.3s;
            position: relative;
            z-index: 1;
        }

        body.fullscreen .container {
            max-width: 100%;
            height: 100vh;
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 30px;
            align-items: center;
            padding: 0 40px;
        }

        h1 {
            text-align: center;
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(0, 180, 255, 0.8), 2px 2px 4px rgba(0,0,0,0.5);
            animation: glow 2s ease-in-out infinite;
        }

        body.fullscreen h1 {
            display: none;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(0, 180, 255, 0.8), 2px 2px 4px rgba(0,0,0,0.5); }
            50% { text-shadow: 0 0 40px rgba(0, 220, 255, 1), 2px 2px 4px rgba(0,0,0,0.5); }
        }

        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        body.fullscreen .subtitle {
            display: none;
        }

        .wheel-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 0 auto 20px;
            transition: all 0.3s;
        }

        body.fullscreen .wheel-container {
            width: 80vh;
            height: 80vh;
            max-width: 90vw;
            max-height: 90vh;
        }

        #wheelCanvas {
            width: 100%;
            height: 100%;
        }

        /* M≈®I T√äN H√åNH ·∫¢NH */
        .wheel-pointer {
            position: absolute;
            top: 15px; /* ƒê·∫©y xu·ªëng s√°t ph·∫ßn m√†u */
            left: 50%;
            transform: translateX(-50%);
            width: 105px; /* Ph√≥ng to 30% (80 * 1.3 ‚âà 105) */
            height: auto;
            z-index: 100;
            filter: drop-shadow(0 5px 8px rgba(0,0,0,0.5));
            transform-origin: center top; /* ƒêi·ªÉm xoay ·ªü ƒë·∫ßu m≈©i t√™n */
            transition: transform 0.05s ease-out;
        }
        
        /* Hi·ªáu ·ª©ng rung khi quay - ƒê·ªò NH·∫†Y CAO */
        .wheel-pointer.shaking {
            animation: pointerShake 0.03s ease-out; /* R·∫•t nhanh: 30ms */
        }
        
        @keyframes pointerShake {
            0% { transform: translateX(-50%) rotate(0deg); }
            50% { transform: translateX(-50%) rotate(25deg); } /* G√≥c r·∫•t l·ªõn */
            100% { transform: translateX(-50%) rotate(0deg); }
        }
        
        /* Ch·ªânh l·∫°i m≈©i t√™n trong fullscreen */
        body.fullscreen .wheel-pointer {
            top: -2px;
            width: 130px; /* Ph√≥ng to 30% (100 * 1.3 = 130) */
        }

        /* LOGO IPC ·ªû GI·ªÆA */
        .center-logo {
            position: absolute;
            top: 50%;
            left: 52%;
            transform: translate(-50%, -50%); /* CƒÉn gi·ªØa ch√≠nh x√°c */
            width: 220px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .center-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* HI·ªÇN TH·ªä T√äN NG∆Ø·ªúI */
        .current-name {
            position: absolute;
            top: -2%; /* Di chuy·ªÉn l√™n tr√™n m≈©i t√™n */
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.8),
                3px 3px 6px rgba(0,0,0,0.8),
                0 0 40px rgba(255, 215, 0, 0.5);
            z-index: 60;
            pointer-events: none;
            display: none;
            white-space: nowrap;
            max-width: 90%;
            text-align: center;
        }

        .current-name.show {
            display: block;
            animation: nameGlow 0.5s ease;
        }

        @keyframes nameGlow {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                text-shadow: 
                    0 0 20px rgba(255, 215, 0, 0.8),
                    3px 3px 6px rgba(0,0,0,0.8);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.15);
                text-shadow: 
                    0 0 40px rgba(255, 215, 0, 1),
                    3px 3px 6px rgba(0,0,0,0.8),
                    0 0 60px rgba(255, 215, 0, 0.8);
            }
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        body.fullscreen .controls {
            display: flex !important;
            flex-direction: column;
            gap: 20px;
            margin: 0;
            justify-content: center;
            z-index: 100;
            position: relative;
        }

        /* N√öT QUAY - CH·∫æ ƒê·ªò TH∆Ø·ªúNG */
        #spinBtn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }

        #spinBtn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        /* N√öT QUAY FULLSCREEN - SI√äU ƒê·∫∏P */
        body.fullscreen #spinBtn {
            width: 240px;
            height: 240px;
            border-radius: 50%;
            font-size: 2.5rem;
            font-weight: 900;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 
                0 10px 40px rgba(102, 126, 234, 0.5),
                0 0 60px rgba(118, 75, 162, 0.3),
                inset 0 -5px 20px rgba(0, 0, 0, 0.2);
            border: 6px solid rgba(255, 255, 255, 0.4);
            animation: pulseGlow 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        /* GLOW EFFECT */
        body.fullscreen #spinBtn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            animation: rotate 3s linear infinite;
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 
                    0 10px 40px rgba(102, 126, 234, 0.5),
                    0 0 60px rgba(118, 75, 162, 0.3),
                    inset 0 -5px 20px rgba(0, 0, 0, 0.2);
                transform: scale(1);
            }
            50% {
                box-shadow: 
                    0 15px 50px rgba(102, 126, 234, 0.7),
                    0 0 80px rgba(118, 75, 162, 0.5),
                    inset 0 -5px 20px rgba(0, 0, 0, 0.2);
                transform: scale(1.05);
            }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        body.fullscreen #spinBtn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 
                0 20px 60px rgba(102, 126, 234, 0.8),
                0 0 100px rgba(118, 75, 162, 0.6),
                inset 0 -5px 20px rgba(0, 0, 0, 0.2);
        }

        body.fullscreen #spinBtn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .upload-section {
            background: rgba(0, 102, 204, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.fullscreen .upload-section {
            display: none;
        }

        .file-input-wrapper {
            display: inline-block;
            margin-bottom: 15px;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            margin: 10px;
        }

        .btn-upload {
            background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
            color: white;
        }

        .btn-exclude {
            background: linear-gradient(135deg, #f7b733 0%, #fc4a1a 100%);
            color: white;
            padding: 12px 30px;
            font-size: 1rem;
            margin-top: 20px;
            font-weight: bold;
        }

        .btn-exclude:hover {
            background: linear-gradient(135deg, #ffd700 0%, #ff6b35 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(247, 183, 51, 0.6);
        }

        .btn-reset {
            background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
            color: white;
            padding: 12px 30px;
            font-size: 1rem;
            margin-top: 10px;
            font-weight: bold;
        }

        .btn-reset:hover {
            background: linear-gradient(135deg, #48cae4 0%, #0096c7 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 180, 216, 0.6);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            width: 100%;
        }

        .btn-summary:hover {
            background: linear-gradient(135deg, #7c8ff0 0%, #8b5bb8 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-back {
            background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
            color: white;
            padding: 15px 50px;
            font-size: 1.2rem;
            margin-top: 40px;
        }

        /* B·∫¢NG VINH DANH - M·∫™U SANG TR·ªåNG */
        .honor-board {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #1a3a5c 0%, #0d2137 50%, #1a3a5c 100%);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }

        .honor-content {
            width: 100vw;
            height: 100vh;
            max-width: none;
            max-height: none;
            overflow-y: auto;
            text-align: center;
            color: white;
            /* Padding ƒë·ªÉ n·ªôi dung cƒÉn gi·ªØa */
            padding: 10vh 15vw;
            /* N·ªÅn t·ª´ background.jpg - C√ôNG N·ªÄN V·ªöI M√ÄN H√åNH QUAY */
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }
        
        /* G√≥c trang tr√≠ - ·∫®N v√¨ d√πng ·∫£nh n·ªÅn */
        .honor-content::before,
        .honor-content::after {
            display: none;
        }
        
        .honor-content h2 {
            font-size: 3.5rem;
            font-weight: bold;
            font-style: italic;
            /* Gradient v√†ng s√°ng */
            background: linear-gradient(180deg, #ffd700 0%, #ffb700 50%, #ff9500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 50px;
            text-shadow: none;
            font-family: 'Georgia', serif;
            letter-spacing: 5px;
            /* Hi·ªáu ·ª©ng glow */
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 165, 0, 0.3));
        }

        .winners-list {
            background: transparent;
            border-radius: 0;
            padding: 0;
            border: none;
        }

        .winner-item {
            background: linear-gradient(180deg, rgba(80, 100, 130, 0.7) 0%, rgba(50, 70, 100, 0.8) 100%);
            padding: 20px 30px;
            margin-bottom: 15px;
            border-radius: 40px;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 1.3rem;
            font-weight: 500;
            animation: slideIn 0.5s ease;
            border: 2px solid rgba(150, 170, 200, 0.4);
            box-shadow: 
                inset 0 2px 10px rgba(255, 255, 255, 0.1),
                0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .winner-item:last-child {
            margin-bottom: 0;
        }

        .winner-item:hover {
            background: linear-gradient(180deg, rgba(90, 115, 145, 0.8) 0%, rgba(60, 85, 115, 0.9) 100%);
            transform: scale(1.02);
        }

        /* Huy ch∆∞∆°ng v√†ng */
        .winner-rank {
            width: 50px;
            height: 50px;
            background: linear-gradient(180deg, #f0d050 0%, #c9a227 50%, #a88520 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #5a3d10;
            box-shadow: 
                0 3px 10px rgba(0, 0, 0, 0.4),
                inset 0 -2px 5px rgba(0, 0, 0, 0.2),
                inset 0 2px 5px rgba(255, 255, 255, 0.3);
            border: 2px solid #8a6a15;
            flex-shrink: 0;
        }

        .winner-name-honor {
            flex: 1;
            text-align: left;
            font-size: 2rem;
            color: #ffffff;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        /* N√∫t Quay l·∫°i - ƒê·∫∑t ·ªü d∆∞·ªõi c√πng */
        .btn-back {
            background: linear-gradient(180deg, #5a6a7a 0%, #3a4a5a 100%);
            color: white;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            /* ƒê·∫∑t ·ªü d∆∞·ªõi c√πng */
            position: absolute;
            bottom: 8vh;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .btn-back:hover {
            background: linear-gradient(180deg, #6a7a8a 0%, #4a5a6a 100%);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* DANH S√ÅCH NG∆Ø·ªúI THAM GIA */
        .participant-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            color: white;
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        .participant-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .participant-item.excluded {
            opacity: 0.4;
            text-decoration: line-through;
            border-left-color: #ff6b6b;
        }

        /* Scrollbar styling */
        #listContainer::-webkit-scrollbar {
            width: 8px;
        }

        #listContainer::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        #listContainer::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        #listContainer::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .fullscreen-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none; /* ·∫®N LU√îN - kh√¥ng c·∫ßn n·ªØa */
            gap: 20px;
            align-items: center;
            background: rgba(0, 102, 204, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 200;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        body:not(.fullscreen) .fullscreen-controls {
            display: none;
        }

        .fullscreen-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: rgba(0, 102, 204, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 200;
        }

        .fullscreen-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            background: rgba(0, 102, 204, 1);
        }
        
        /* N√öT C√ÄI ƒê·∫∂T */
        .settings-toggle {
            position: fixed;
            top: 20px;
            right: 170px;
            padding: 12px 24px;
            background: rgba(80, 80, 80, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 200;
        }

        .settings-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            background: rgba(100, 100, 100, 1);
        }
        
        /* MODAL C√ÄI ƒê·∫∂T */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .settings-content {
            background: linear-gradient(180deg, #1a3a5c 0%, #0d2137 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }
        
        .settings-content h2 {
            text-align: center;
            color: #ffd700;
            font-size: 1.8rem;
            margin-bottom: 30px;
        }
        
        .settings-group {
            margin-bottom: 25px;
        }
        
        .settings-group label {
            display: block;
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .settings-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }
        
        .btn-save {
            background: linear-gradient(180deg, #28a745 0%, #1e7e34 100%);
        }
        
        .btn-cancel {
            background: linear-gradient(180deg, #dc3545 0%, #c82333 100%);
        }
        
        .btn-reset {
            background: linear-gradient(180deg, #6c757d 0%, #545b62 100%);
        }
        
        /* N√∫t upload trong c√†i ƒë·∫∑t */
        .btn-upload-setting {
            background: linear-gradient(180deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .btn-upload-setting:hover {
            background: linear-gradient(180deg, #1fc8e3 0%, #17a2b8 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.4);
        }
        
        .upload-wrapper {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .time-control {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0, 102, 204, 0.2);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 25px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        body.fullscreen .time-control {
            display: none;
        }

        .time-control label {
            font-weight: bold;
            color: white;
        }

        .time-control input[type="number"] {
            width: 80px;
            padding: 8px 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            font-weight: bold;
            text-align: center;
        }

        .time-control input[type="range"] {
            width: 200px;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(90deg, #FFD700 0%, #FFA500 100%);
            outline: none;
            -webkit-appearance: none;
        }

        .time-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.95); /* N·ªÅn tr·∫Øng s√°ng r√µ */
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* B√≥ng ƒë·ªï r√µ */
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s;
            color: #333; /* Ch·ªØ ƒë·∫≠m m√†u */
        }

        .result.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* RESULT PANEL FULLSCREEN - R√ï R√ÄNG H∆†N */
        body.fullscreen .result {
            display: flex !important;
            flex-direction: column;
            justify-content: center;
            height: 85vh;
            padding: 30px;
            background: rgba(0, 40, 80, 0.9); /* N·ªÅn xanh ƒë·∫≠m g·∫ßn nh∆∞ ƒë·∫∑c */
            border: 2px solid rgba(255, 215, 0, 0.5); /* Vi·ªÅn v√†ng r√µ */
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            opacity: 1; /* Lu√¥n hi·ªÉn th·ªã r√µ */
            transform: translateY(0);
            color: white; /* Ch·ªØ tr·∫Øng s√°ng */
        }

        body.fullscreen .result:not(.show) {
            opacity: 1; /* Lu√¥n hi·ªÉn th·ªã r√µ 100% */
        }

        body.fullscreen .result.show {
            opacity: 1;
        }

        body.fullscreen .winner-name {
            font-size: 4rem;
            margin: 30px 0;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .winner-name {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 2px 2px 4px rgba(0,0,0,0.5);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s linear;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* THANH HI·ªÇN TH·ªä 5 NG∆Ø·ªúI L√ÇN C·∫¨N */
        .adjacent-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.9) 100%);
            border-top: 3px solid rgba(255, 215, 0, 0.5);
            z-index: 100;
        }
        
        .adjacent-item {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            min-width: 150px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .adjacent-item.adjacent-current {
            background: linear-gradient(180deg, #ff6b35 0%, #f7c200 100%);
            color: white;
            font-size: 1.2rem;
            padding: 15px 35px;
            min-width: 200px;
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.6);
            transform: scale(1.1);
        }
        
        body:not(.fullscreen) .adjacent-bar {
            display: none;
        }

        .participant-count {
            background: rgba(0, 180, 255, 0.8);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .info-text {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 10px;
        }

        .tick-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            opacity: 0;
            transition: opacity 0.1s;
        }

        .tick-indicator.active {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- N√∫t C√†i ƒë·∫∑t -->
    <button class="settings-toggle" onclick="toggleSettings()">
        ‚öôÔ∏è C√†i ƒë·∫∑t
    </button>
    
    <button class="fullscreen-toggle" onclick="toggleFullscreen()">
        <span id="fullscreenText">üî≤ M·ªü r·ªông</span>
    </button>
    <!-- MODAL C√ÄI ƒê·∫∂T -->
    <div id="settingsModal" class="settings-modal" style="display: none;">
        <div class="settings-content">
            <h2>‚öôÔ∏è C√ÄI ƒê·∫∂T GIAO DI·ªÜN</h2>
            
            <div class="settings-group">
                <label>üìù T√™n ch·ªß ƒë·ªÅ:</label>
                <input type="text" id="settingsTitle" value="üé° V√íNG XOAY MAY M·∫ÆN - IPC üé°" 
                       style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem;">
            </div>
            
            <div class="settings-group">
                <label>üñºÔ∏è Thay ƒë·ªïi ·∫£nh n·ªÅn:</label>
                <div class="upload-wrapper">
                    <input type="file" id="bgImageInput" accept="image/*" style="display: none;">
                    <button type="button" class="btn btn-upload-setting" onclick="document.getElementById('bgImageInput').click()">
                        üìÅ Ch·ªçn ·∫£nh n·ªÅn
                    </button>
                    <span id="bgFileName" style="color: #aaa; font-size: 0.9rem; margin-left: 10px;">Ch∆∞a ch·ªçn ·∫£nh</span>
                </div>
            </div>
            
            <div class="settings-group">
                <label>üéØ Thay ƒë·ªïi logo trung t√¢m:</label>
                <div class="upload-wrapper">
                    <input type="file" id="logoImageInput" accept="image/*" style="display: none;">
                    <button type="button" class="btn btn-upload-setting" onclick="document.getElementById('logoImageInput').click()">
                        üìÅ Ch·ªçn logo
                    </button>
                    <span id="logoFileName" style="color: #aaa; font-size: 0.9rem; margin-left: 10px;">Ch∆∞a ch·ªçn ·∫£nh</span>
                </div>
                <div style="margin-top: 15px;">
                    <label>K√≠ch th∆∞·ªõc logo: <span id="logoSizeValue">25</span>%</label>
                    <input type="range" id="logoSizeSlider" min="10" max="50" value="25" 
                           style="width: 100%;" oninput="updateLogoSize(this.value)">
                </div>
            </div>
            
            <div class="settings-buttons">
                <button class="btn btn-save" onclick="saveSettings()">üíæ L∆∞u c√†i ƒë·∫∑t</button>
                <button class="btn btn-cancel" onclick="toggleSettings()">‚ùå ƒê√≥ng</button>
                <button class="btn btn-reset" onclick="resetSettings()">üîÑ Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh</button>
            </div>
        </div>
    </div>

    <div class="container">
        <h1 id="mainTitle">üé° V√íNG XOAY MAY M·∫ÆN - IPC üé°</h1>
        <p class="subtitle">·ª®ng d·ª•ng quay s·ªë t∆∞∆°ng t√°c - H·ªó tr·ª£ l√™n ƒë·∫øn 400 ng∆∞·ªùi</p>

        <div class="upload-section">
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" accept=".xlsx,.xls">
                <label for="fileInput" class="btn btn-upload">üìä T·∫£i l√™n file Excel</label>
            </div>
            <p class="info-text">Ch·ªçn file Excel v·ªõi c·ªôt ƒë·∫ßu ti√™n ch·ª©a danh s√°ch t√™n</p>
            <div id="participantInfo" style="display: none;">
                <div class="participant-count">
                    üë• <span id="participantCount">0</span> ng∆∞·ªùi tham gia
                </div>
            </div>
        </div>

        <div class="time-control">
            <label>‚è±Ô∏è Th·ªùi gian quay:</label>
            <input type="number" id="spinDuration" min="1" max="30" value="10" step="1">
            <span>gi√¢y</span>
            <input type="range" id="spinDurationSlider" min="1" max="30" value="10" step="1">
            
            <!-- N√∫t ·∫©n/hi·ªán t√™n -->
            <label style="margin-left: 20px; display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="showNamesToggle" checked 
                       style="width: 18px; height: 18px; cursor: pointer;">
                <span>üìù Hi·ªán t√™n</span>
            </label>
        </div>

        <!-- C·ªòT 1: N√öT QUAY (cho fullscreen) -->
        <div class="controls">
            <button class="btn btn-upload" id="spinBtn" onclick="spinWheel()">QUAY</button>
        </div>

        <!-- C·ªòT 2: V√íNG QUAY -->
        <div class="wheel-container">
            <canvas id="wheelCanvas" width="1200" height="1200"></canvas>
            <img src="pointer-arrow.png" alt="Pointer" class="wheel-pointer">
            <div class="center-logo" id="centerLogoContainer">
                <img src="ipc-logo.png" alt="IPC Logo" id="centerLogoImg">
            </div>
            <div class="current-name" id="currentName">Nguy·ªÖn VƒÉn A</div>
            <div class="tick-indicator" id="tickIndicator">üîî</div>
        </div>

        <!-- C·ªòT 3: K·∫æT QU·∫¢ & DANH S√ÅCH -->
        <div id="result" class="result">
            <!-- K·∫øt qu·∫£ tr√∫ng th∆∞·ªüng -->
            <div id="winnerSection" style="display: none;">
                <h2>üéâ CH√öC M·ª™NG üéâ</h2>
                <div class="winner-name" id="winnerName"></div>
                <p>B·∫°n ƒë√£ tr√∫ng th∆∞·ªüng!</p>
                <div style="display: flex; gap: 10px; flex-direction: column;">
                    <button class="btn btn-exclude" id="excludeBtn" onclick="excludeWinner()">
                        üèÜ Ng∆∞·ªùi th·∫Øng cu·ªôc
                    </button>
                    <button class="btn btn-reset" id="resetBtn" onclick="resetWinner()">
                        üîÑ Quay l·∫°i
                    </button>
                </div>
            </div>

            <!-- Danh s√°ch ng∆∞·ªùi tr√∫ng th∆∞·ªüng -->
            <div id="participantList" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #FFD700;">
                    üèÜ Danh s√°ch tr√∫ng th∆∞·ªüng (<span id="listCount">0</span>)
                </h3>
                <div id="listContainer" style="
                    max-height: 50vh;
                    overflow-y: auto;
                    background: rgba(0, 0, 0, 0.2);
                    border-radius: 10px;
                    padding: 10px;
                    margin-bottom: 15px;
                ">
                    <!-- Danh s√°ch s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
                </div>
                
                <!-- N√∫t T·ªîNG K·∫æT -->
                <button class="btn btn-summary" id="summaryBtn" onclick="showSummary()" style="display: none;">
                    üìä T·ªîNG K·∫æT
                </button>
            </div>
        </div>
    </div>

    <!-- THANH HI·ªÇN TH·ªä: 5 NG∆Ø·ªúI TR∆Ø·ªöC + NG∆Ø·ªúI ƒêANG CH·ªåN (b√™n ph·∫£i) -->
    <div id="adjacentBar" class="adjacent-bar">
        <div class="adjacent-item" id="adj-0">-</div>
        <div class="adjacent-item" id="adj-1">-</div>
        <div class="adjacent-item" id="adj-2">-</div>
        <div class="adjacent-item" id="adj-3">-</div>
        <div class="adjacent-item" id="adj-4">-</div>
        <div class="adjacent-item adjacent-current" id="adj-5">-</div>
    </div>

    <!-- B·∫¢NG VINH DANH (·∫®n m·∫∑c ƒë·ªãnh) -->
    <div id="honorBoard" class="honor-board" style="display: none;">
        <div class="honor-content">
            <h2>NG∆Ø·ªúI TH·∫ÆNG CU·ªòC</h2>
            
            <div id="winnersList" class="winners-list">
                <!-- Danh s√°ch ng∆∞·ªùi th·∫Øng s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
            </div>
            
            <button class="btn btn-back" onclick="hideSummary()">
                ‚Üê Quay l·∫°i
            </button>
        </div>
    </div>

    <div class="fullscreen-controls">
        <label style="color: white; font-weight: bold;">‚è±Ô∏è Th·ªùi gian:</label>
        <input type="number" id="spinDurationFS" min="1" max="30" value="10" step="1" 
               style="width: 70px; padding: 8px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); text-align: center; font-weight: bold; background: rgba(255,255,255,0.9);">
        <span style="color: white;">gi√¢y</span>
        <input type="range" id="spinDurationSliderFS" min="1" max="30" value="10" step="1" 
               style="width: 200px;">
    </div>

    <audio id="tickSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQA=" type="audio/wav">
    </audio>

    <script src="xlsx.full.min.js"></script>
    <script>
        // Danh s√°ch m·∫´u m·∫∑c ƒë·ªãnh ƒë·ªÉ hi·ªÉn th·ªã v√≤ng quay ngay khi m·ªü
        const demoParticipants = [
            'Nguy·ªÖn VƒÉn A', 'Tr·∫ßn Th·ªã B', 'L√™ VƒÉn C', 'Ph·∫°m Th·ªã D',
            'Ho√†ng VƒÉn E', 'V≈© Th·ªã F', 'ƒê·∫∑ng VƒÉn G', 'B√πi Th·ªã H',
            'ƒê·ªó VƒÉn I', 'Ng√¥ Th·ªã K', 'D∆∞∆°ng VƒÉn L', 'L√Ω Th·ªã M'
        ];
        
        let participants = [...demoParticipants]; // Kh·ªüi t·∫°o v·ªõi danh s√°ch m·∫´u
        let winners = []; // Danh s√°ch ng∆∞·ªùi th·∫Øng (hi·ªÉn th·ªã trong danh s√°ch tr√∫ng th∆∞·ªüng)
        let excludedParticipants = []; // Danh s√°ch ng∆∞·ªùi b·ªã lo·∫°i kh·ªèi v√≤ng quay (khi b·∫•m X)
        let currentWinner = null; // Ng∆∞·ªùi th·∫Øng hi·ªán t·∫°i
        let isSpinning = false;
        let currentRotation = 0;
        let lastSegment = -1;
        let spinDuration = 10000; // Default 10 seconds

        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const fileInput = document.getElementById('fileInput');
        const currentNameEl = document.getElementById('currentName');
        const tickIndicator = document.getElementById('tickIndicator');
        const tickSound = document.getElementById('tickSound');
        const pointer = document.querySelector('.wheel-pointer'); // M≈©i t√™n

        // Sync time controls
        const spinDurationInput = document.getElementById('spinDuration');
        const spinDurationSlider = document.getElementById('spinDurationSlider');
        const spinDurationInputFS = document.getElementById('spinDurationFS');
        const spinDurationSliderFS = document.getElementById('spinDurationSliderFS');
        const showNamesToggle = document.getElementById('showNamesToggle');
        
        let showNames = true; // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã t√™n

        function syncTimeControls(value) {
            spinDuration = value * 1000;
            spinDurationInput.value = value;
            spinDurationSlider.value = value;
            spinDurationInputFS.value = value;
            spinDurationSliderFS.value = value;
        }

        spinDurationInput.addEventListener('input', (e) => syncTimeControls(e.target.value));
        spinDurationSlider.addEventListener('input', (e) => syncTimeControls(e.target.value));
        spinDurationInputFS.addEventListener('input', (e) => syncTimeControls(e.target.value));
        spinDurationSliderFS.addEventListener('input', (e) => syncTimeControls(e.target.value));
        
        // Toggle hi·ªÉn th·ªã t√™n
        showNamesToggle.addEventListener('change', (e) => {
            showNames = e.target.checked;
            drawWheel(); // V·∫Ω l·∫°i v√≤ng quay
        });

        function toggleFullscreen() {
            document.body.classList.toggle('fullscreen');
            const text = document.getElementById('fullscreenText');
            if (document.body.classList.contains('fullscreen')) {
                text.textContent = 'üî≥ Thu nh·ªè';
            } else {
                text.textContent = 'üî≤ M·ªü r·ªông';
            }
        }

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                readExcelFile(file);
            }
        });

        function readExcelFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    participants = extractParticipants(jsonData);
                    
                    if (participants.length === 0) {
                        alert('‚ùå Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu!');
                        return;
                    }
                    
                    if (participants.length > 400) {
                        participants = participants.slice(0, 400);
                        alert('‚ö†Ô∏è Ch·ªâ l·∫•y 400 ng∆∞·ªùi ƒë·∫ßu ti√™n');
                    }
                    
                    document.getElementById('participantCount').textContent = participants.length;
                    document.getElementById('participantInfo').style.display = 'block';
                    spinBtn.disabled = false;
                    
                    // Render danh s√°ch
                    renderParticipantList();
                    
                    drawWheel();
                } catch (error) {
                    alert('‚ùå L·ªói ƒë·ªçc file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function extractParticipants(data) {
            const names = [];
            let startRow = 0;
            
            if (data.length > 0 && data[0][0]) {
                const firstCell = String(data[0][0]).toLowerCase();
                if (firstCell.includes('t√™n') || firstCell.includes('name')) {
                    startRow = 1;
                }
            }
            
            for (let i = startRow; i < data.length; i++) {
                if (data[i] && data[i][0]) {
                    const name = String(data[i][0]).trim();
                    if (name && name.length > 0) {
                        names.push(name);
                    }
                }
            }
            
            return names;
        }

        function drawWheel(rotation = 0) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = canvas.width * 0.42;
            
            // Ch·ªâ v·∫Ω ng∆∞·ªùi ch∆∞a b·ªã lo·∫°i tr·ª´
            const activeParticipants = participants.filter(name => !excludedParticipants.includes(name));
            
            if (activeParticipants.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(rotation);
            ctx.translate(-centerX, -centerY);
            
            // B·∫£ng m√†u theo phong c√°ch ·∫£nh m·∫´u (Flat Design)
            const palette = [
                '#FFD700', // V√†ng (Yellow)
                '#FF8C00', // Cam ƒë·∫≠m (Dark Orange)
                '#40E0D0', // Xanh ng·ªçc (Turquoise)
                '#FF69B4', // H·ªìng (Hot Pink)
                '#9370DB', // T√≠m (Medium Purple)
                '#20B2AA', // Xanh bi·ªÉn nh·∫°t (Light Sea Green)
                '#F08080', // ƒê·ªè san h√¥ (Light Coral)
                '#87CEEB', // Xanh da tr·ªùi (Sky Blue)
                '#DDA0DD'  // T√≠m nh·∫°t (Plum)
            ];

            const count = activeParticipants.length;
            const anglePerSegment = (2 * Math.PI) / count;
            
            // V·∫Ω c√°c m√∫i m√†u
            activeParticipants.forEach((name, index) => {
                const startAngle = index * anglePerSegment - Math.PI / 2;
                const endAngle = (index + 1) * anglePerSegment - Math.PI / 2;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                
                // L·∫•y m√†u t·ª´ palette l·∫∑p l·∫°i
                ctx.fillStyle = palette[index % palette.length];
                ctx.fill();
                
                // Vi·ªÅn tr·∫Øng m·ªèng gi·ªØa c√°c m√∫i
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // V·∫º T√äN L√äN √î M√ÄU (ch·ªâ khi showNames = true)
                if (showNames) {
                ctx.save();
                
                // T√≠nh g√≥c gi·ªØa c·ªßa segment
                const midAngle = startAngle + anglePerSegment / 2;
                
                // Di chuy·ªÉn ƒë·∫øn t√¢m v√≤ng quay
                ctx.translate(centerX, centerY);
                
                // Xoay theo g√≥c c·ªßa segment
                ctx.rotate(midAngle);
                
                // Style text
                const fontSize = count > 30 ? 12 : (count > 20 ? 14 : (count > 10 ? 16 : 20));
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.fillStyle = '#FFFFFF';
                ctx.strokeStyle = 'rgba(0,0,0,0.6)';
                ctx.lineWidth = 3;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Hi·ªÉn th·ªã t√™n ƒë·∫ßy ƒë·ªß (ch·ªâ r√∫t g·ªçn n·∫øu qu√° d√†i)
                let displayName = name;
                if (name.length > 25) {
                    displayName = name.substring(0, 22) + '...';
                }
                
                // V·ªã tr√≠ text (60% b√°n k√≠nh t·ª´ t√¢m)
                const textDistance = radius * 0.65;
                
                // V·∫Ω text theo chi·ªÅu d·ªçc (t·ª´ t√¢m ra ngo√†i)
                ctx.strokeText(displayName, textDistance, 0);
                ctx.fillText(displayName, textDistance, 0);
                
                ctx.restore();
                } // ƒê√≥ng if (showNames)
            });
            
            // VI·ªÄN NGO√ÄI: Xanh d∆∞∆°ng ƒë·∫≠m d√†y (theo m·∫´u ·∫£nh)
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = '#003366'; // Xanh d∆∞∆°ng ƒë·∫≠m
            ctx.lineWidth = 25; // Vi·ªÅn d√†y
            ctx.stroke();

            // Vi·ªÅn ƒëen m·ªèng bao ngo√†i c√πng (t·∫°o kh·ªëi)
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius + 12, 0, 2 * Math.PI);
            ctx.strokeStyle = 'rgba(0,0,0,0.3)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            ctx.restore();
        }

        function generateColors(count) {
            const baseColors = [
                '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8',
                '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#52B788',
                '#E63946', '#457B9D', '#F4A261', '#2A9D8F', '#E76F51',
                '#264653', '#E9C46A', '#8D99AE', '#EF476F', '#06FFA5'
            ];
            
            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(baseColors[i % baseColors.length]);
            }
            return colors;
        }

        function spinWheel() {
            const activeParticipants = participants.filter(name => !excludedParticipants.includes(name));
            
            if (isSpinning || activeParticipants.length === 0) {
                if (activeParticipants.length === 0) {
                    alert('‚ùå Kh√¥ng c√≤n ng∆∞·ªùi n√†o ƒë·ªÉ quay!');
                }
                return;
            }
            
            isSpinning = true;
            spinBtn.disabled = true;
            document.getElementById('winnerSection').style.display = 'none';
            currentNameEl.classList.add('show');
            
            const spins = 5 + Math.random() * 5;
            const extraDegrees = Math.random() * 360;
            const totalRotation = currentRotation + (spins * 360 + extraDegrees);
            
            const startTime = Date.now();
            const startRotation = currentRotation;
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / spinDuration, 1);
                
                // CH·∫¨M D·∫¶N M·∫†NH H∆†N
                const easeOut = 1 - Math.pow(1 - progress, 5); // Power 5 cho ch·∫≠m d·∫ßn m·∫°nh
                const rotation = startRotation + (totalRotation - startRotation) * easeOut;
                
                drawWheel(rotation * Math.PI / 180);
                
                const normalizedRotation = (rotation % 360 + 360) % 360;
                const count = activeParticipants.length;
                const anglePerSegment = 360 / count;
                // ƒê·ªìng b·ªô c√¥ng th·ª©c v·ªõi showWinner
                const rawIndex = Math.floor(normalizedRotation / anglePerSegment);
                const currentSegment = (count - rawIndex - 1 + count) % count;
                
                // HI·ªÇN TH·ªä T√äN T·ª™NG NG∆Ø·ªúI
                if (currentSegment !== lastSegment) {
                    lastSegment = currentSegment;
                    const currentPerson = activeParticipants[currentSegment];
                    currentNameEl.textContent = currentPerson;
                    currentNameEl.classList.remove('show');
                    void currentNameEl.offsetWidth;
                    currentNameEl.classList.add('show');
                    
                    // C·∫¨P NH·∫¨T THANH 5 NG∆Ø·ªúI L√ÇN C·∫¨N
                    updateAdjacentBar(activeParticipants, currentSegment);
                    
                    playTick();
                }
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    currentRotation = totalRotation % 360;
                    setTimeout(() => {
                        currentNameEl.classList.remove('show');
                        showWinner();
                    }, 500);
                }
            }
            
            animate();
        }

        function playTick() {
            tickIndicator.classList.add('active');
            setTimeout(() => tickIndicator.classList.remove('active'), 100);
            
            // Hi·ªáu ·ª©ng rung m≈©i t√™n
            pointer.classList.remove('shaking');
            void pointer.offsetWidth; // Force reflow ƒë·ªÉ reset animation
            pointer.classList.add('shaking');
            
            try {
                tickSound.currentTime = 0;
                tickSound.play().catch(() => {});
            } catch (e) {}
        }

        // C·∫¨P NH·∫¨T THANH: 5 NG∆Ø·ªúI TR∆Ø·ªöC + NG∆Ø·ªúI ƒêANG CH·ªåN (b√™n ph·∫£i)
        // C·∫¨P NH·∫¨T THANH: 5 NG∆Ø·ªúI TR∆Ø·ªöC + NG∆Ø·ªúI ƒêANG CH·ªåN (b√™n ph·∫£i)
        function updateAdjacentBar(participants, currentIndex) {
            const count = participants.length;
            if (count === 0) return;
            
            // √î 0-4: 5 ng∆∞·ªùi tr∆∞·ªõc ƒë√≥ (t·ª´ xa ƒë·∫øn g·∫ßn)
            // √î 5: ng∆∞·ªùi hi·ªán t·∫°i
            for (let i = 0; i < 6; i++) {
                const el = document.getElementById('adj-' + i);
                if (el) {
                    // i=0 l√† ng∆∞·ªùi c√°ch 5 b∆∞·ªõc tr∆∞·ªõc, i=5 l√† ng∆∞·ªùi hi·ªán t·∫°i
                    const offset = i - 5; // -5, -4, -3, -2, -1, 0
                    const idx = (currentIndex + offset + count) % count;
                    el.textContent = participants[idx] || '-';
                }
            }
        }

        // X√≥a thanh khi kh√¥ng quay
        function clearAdjacentBar() {
            for (let i = 0; i < 6; i++) {
                const el = document.getElementById('adj-' + i);
                if (el) el.textContent = '-';
            }
        }

        function showWinner() {
            const activeParticipants = participants.filter(name => !excludedParticipants.includes(name));
            const count = activeParticipants.length;
            const anglePerSegment = 360 / count;
            const normalizedRotation = (currentRotation % 360 + 360) % 360;
            
            // T√≠nh segment m√† m≈©i t√™n ƒëang ch·ªâ v√†o
            // M≈©i t√™n ·ªü v·ªã tr√≠ 12 gi·ªù (tr√™n c√πng), v√≤ng quay xoay theo chi·ªÅu kim ƒë·ªìng h·ªì
            // Khi rotation tƒÉng, segment "tr∆∞·ªõc ƒë√≥" s·∫Ω ƒë·∫øn v·ªã tr√≠ m≈©i t√™n
            const rawIndex = Math.floor(normalizedRotation / anglePerSegment);
            const winnerIndex = (count - rawIndex - 1 + count) % count;
            const winner = activeParticipants[winnerIndex];
            
            // L∆∞u ng∆∞·ªùi th·∫Øng hi·ªán t·∫°i
            currentWinner = winner;
            
            // Hi·ªÉn th·ªã t√™n ng∆∞·ªùi th·∫Øng
            document.getElementById('winnerName').textContent = winner;
            document.getElementById('winnerSection').style.display = 'block';
            
            createConfetti();
            
            setTimeout(() => {
                isSpinning = false;
                // Gi·ªØ n√∫t disabled cho ƒë·∫øn khi lo·∫°i tr·ª´ ho·∫∑c reset
                lastSegment = -1;
            }, 1000);
        }

        function createConfetti() {
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 20);
            }
        }

        function resetWheel() {
            document.getElementById('winnerSection').style.display = 'none';
            spinBtn.disabled = false;
            currentNameEl.classList.remove('show');
            currentWinner = null;
        }

        // Reset ƒë·ªÉ quay l·∫°i (kh√¥ng lo·∫°i tr·ª´)
        function resetWinner() {
            document.getElementById('winnerSection').style.display = 'none';
            spinBtn.disabled = false;
            currentWinner = null;
        }

        // Render danh s√°ch ng∆∞·ªùi tr√∫ng th∆∞·ªüng
        function renderParticipantList() {
            const listContainer = document.getElementById('listContainer');
            const listCount = document.getElementById('listCount');
            const participantList = document.getElementById('participantList');
            const summaryBtn = document.getElementById('summaryBtn');
            
            // Hi·ªÉn th·ªã panel danh s√°ch
            participantList.style.display = 'block';
            
            // ƒê·∫øm s·ªë ng∆∞·ªùi tr√∫ng
            listCount.textContent = winners.length;
            
            // Render danh s√°ch ng∆∞·ªùi tr√∫ng
            if (winners.length === 0) {
                 listContainer.innerHTML = '<div style="color: #ccc; font-style: italic; padding: 10px; text-align: center;">Ch∆∞a c√≥ ng∆∞·ªùi tr√∫ng th∆∞·ªüng</div>';
            } else {
                listContainer.innerHTML = winners.map((name, index) => {
                    return `
                        <div class="participant-item" style="border-left-color: #FFD700; background: rgba(255, 215, 0, 0.1); display: flex; justify-content: space-between; align-items: center;">
                            <span>${index + 1}. ${name}</span>
                            <button onclick="removeFromWinners(${index})" style="
                                background: rgba(255, 100, 100, 0.8);
                                border: none;
                                color: white;
                                width: 24px;
                                height: 24px;
                                border-radius: 50%;
                                cursor: pointer;
                                font-size: 14px;
                                font-weight: bold;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                transition: all 0.2s;
                            " onmouseover="this.style.background='rgba(255,50,50,1)'" onmouseout="this.style.background='rgba(255,100,100,0.8)'">‚úï</button>
                        </div>
                    `;
                }).join('');
            }
            
            // Hi·ªÉn th·ªã n√∫t T·ªîNG K·∫æT n·∫øu c√≥ ng∆∞·ªùi th·∫Øng
            if (winners.length > 0) {
                summaryBtn.style.display = 'block';
            } else {
                summaryBtn.style.display = 'none';
            }
        }

        // Th√™m ng∆∞·ªùi th·∫Øng v√†o danh s√°ch (KH√îNG lo·∫°i kh·ªèi v√≤ng quay)
        function excludeWinner() {
            if (!currentWinner) return;
            
            // Th√™m v√†o danh s√°ch ng∆∞·ªùi th·∫Øng (kh√¥ng lo·∫°i kh·ªèi v√≤ng quay)
            if (!winners.includes(currentWinner)) {
                winners.push(currentWinner);
            }
            
            // C·∫≠p nh·∫≠t danh s√°ch hi·ªÉn th·ªã
            renderParticipantList();
            
            // ·∫®n winner section
            document.getElementById('winnerSection').style.display = 'none';
            
            // Enable n√∫t quay
            spinBtn.disabled = false;
            currentWinner = null;
            
            // KH√îNG v·∫Ω l·∫°i v√≤ng quay (ng∆∞·ªùi th·∫Øng v·∫´n c√≤n tr√™n v√≤ng quay)
        }

        // X√≥a ng∆∞·ªùi kh·ªèi danh s√°ch tr√∫ng th∆∞·ªüng V√Ä lo·∫°i kh·ªèi v√≤ng quay
        function removeFromWinners(index) {
            const removedName = winners[index];
            if (!removedName) return;
            
            // Th√™m v√†o danh s√°ch b·ªã lo·∫°i kh·ªèi v√≤ng quay
            if (!excludedParticipants.includes(removedName)) {
                excludedParticipants.push(removedName);
            }
            
            // X√≥a kh·ªèi danh s√°ch tr√∫ng th∆∞·ªüng
            winners.splice(index, 1);
            
            // C·∫≠p nh·∫≠t danh s√°ch hi·ªÉn th·ªã
            renderParticipantList();
            
            // V·∫Ω l·∫°i v√≤ng quay (ng∆∞·ªùi b·ªã x√≥a s·∫Ω b·ªã lo·∫°i kh·ªèi v√≤ng quay)
            drawWheel();
            
            // Enable n√∫t quay n·∫øu c√≤n ng∆∞·ªùi ch∆°i
            const activeParticipants = participants.filter(name => !excludedParticipants.includes(name));
            if (activeParticipants.length > 0) {
                spinBtn.disabled = false;
            }
        }

        // Hi·ªÉn th·ªã b·∫£ng vinh danh
        function showSummary() {
            const honorBoard = document.getElementById('honorBoard');
            const winnersList = document.getElementById('winnersList');
            
            // Render danh s√°ch ng∆∞·ªùi th·∫Øng
            if (winners.length === 0) {
                alert('Ch∆∞a c√≥ ng∆∞·ªùi th·∫Øng cu·ªôc n√†o!');
                return;
            }
            
            winnersList.innerHTML = winners.map((name, index) => {
                // Hi·ªÉn th·ªã s·ªë th·ª© t·ª± trong huy ch∆∞∆°ng v√†ng
                const rankNumber = index + 1;
                
                return `
                    <div class="winner-item" style="animation-delay: ${index * 0.1}s">
                        <div class="winner-rank">${rankNumber}</div>
                        <div class="winner-name-honor">${name}</div>
                    </div>
                `;
            }).join('');
            
            // Hi·ªÉn th·ªã b·∫£ng vinh danh
            honorBoard.style.display = 'flex';
        }

        // ·∫®n b·∫£ng vinh danh
        function hideSummary() {
            const honorBoard = document.getElementById('honorBoard');
            honorBoard.style.display = 'none';
        }

        // ============ C√ÄI ƒê·∫∂T GIAO DI·ªÜN ============
        
        let customLogoImage = null;
        let customLogoSize = 25;
        let customBgImage = null;
        
        // Toggle modal c√†i ƒë·∫∑t
        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            if (modal.style.display === 'none') {
                modal.style.display = 'flex';
            } else {
                modal.style.display = 'none';
            }
        }
        
        // C·∫≠p nh·∫≠t gi√° tr·ªã slider logo size
        function updateLogoSize(value) {
            document.getElementById('logoSizeValue').textContent = value;
            customLogoSize = parseInt(value);
        }
        
        // Hi·ªÉn th·ªã t√™n file khi ch·ªçn ·∫£nh
        document.getElementById('bgImageInput').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : 'Ch∆∞a ch·ªçn ·∫£nh';
            document.getElementById('bgFileName').textContent = fileName;
            document.getElementById('bgFileName').style.color = '#4CAF50';
        });
        
        document.getElementById('logoImageInput').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : 'Ch∆∞a ch·ªçn ·∫£nh';
            document.getElementById('logoFileName').textContent = fileName;
            document.getElementById('logoFileName').style.color = '#4CAF50';
        });
        
        // L∆∞u c√†i ƒë·∫∑t
        function saveSettings() {
            // L·∫•y c√°c gi√° tr·ªã
            const newTitle = document.getElementById('settingsTitle').value;
            const bgInput = document.getElementById('bgImageInput');
            const logoInput = document.getElementById('logoImageInput');
            
            // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ
            document.getElementById('mainTitle').textContent = newTitle;
            
            // X·ª≠ l√Ω ·∫£nh n·ªÅn
            if (bgInput.files && bgInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    customBgImage = e.target.result;
                    document.body.style.backgroundImage = `url('${customBgImage}')`;
                    // L∆∞u v√†o localStorage
                    localStorage.setItem('wheelBgImage', customBgImage);
                };
                reader.readAsDataURL(bgInput.files[0]);
            }
            
            // X·ª≠ l√Ω logo
            if (logoInput.files && logoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Thay ƒë·ªïi logo HTML
                    const logoImg = document.getElementById('centerLogoImg');
                    logoImg.src = e.target.result;
                    
                    // Thay ƒë·ªïi k√≠ch th∆∞·ªõc logo
                    const logoContainer = document.getElementById('centerLogoContainer');
                    logoContainer.style.width = customLogoSize + '%';
                    logoContainer.style.height = customLogoSize + '%';
                    
                    // L∆∞u v√†o localStorage
                    localStorage.setItem('wheelLogo', e.target.result);
                    localStorage.setItem('wheelLogoSize', customLogoSize);
                };
                reader.readAsDataURL(logoInput.files[0]);
            } else {
                // Ch·ªâ thay ƒë·ªïi k√≠ch th∆∞·ªõc n·∫øu kh√¥ng c√≥ logo m·ªõi
                const logoContainer = document.getElementById('centerLogoContainer');
                logoContainer.style.width = customLogoSize + '%';
                logoContainer.style.height = customLogoSize + '%';
                localStorage.setItem('wheelLogoSize', customLogoSize);
            }
            
            // L∆∞u c√°c c√†i ƒë·∫∑t kh√°c v√†o localStorage
            localStorage.setItem('wheelTitle', newTitle);
            localStorage.setItem('wheelLogoSize', customLogoSize);
            
            // V·∫Ω l·∫°i v√≤ng quay
            drawWheel();
            
            alert('‚úÖ ƒê√£ l∆∞u c√†i ƒë·∫∑t th√†nh c√¥ng!');
            toggleSettings();
        }
        
        // Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh
        function resetSettings() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën kh√¥i ph·ª•c t·∫•t c·∫£ c√†i ƒë·∫∑t v·ªÅ m·∫∑c ƒë·ªãnh?')) {
                // X√≥a localStorage
                localStorage.removeItem('wheelTitle');
                localStorage.removeItem('wheelBgImage');
                localStorage.removeItem('wheelLogo');
                localStorage.removeItem('wheelLogoSize');
                
                // Reset c√°c gi√° tr·ªã
                document.getElementById('mainTitle').textContent = 'üé° V√íNG XOAY MAY M·∫ÆN - IPC üé°';
                document.getElementById('settingsTitle').value = 'üé° V√íNG XOAY MAY M·∫ÆN - IPC üé°';
                document.body.style.backgroundImage = "url('background.jpg')";
                
                // Reset logo
                const logoImg = document.getElementById('centerLogoImg');
                const logoContainer = document.getElementById('centerLogoContainer');
                if (logoImg) logoImg.src = 'ipc-logo.png';
                if (logoContainer) {
                    logoContainer.style.width = '25%';
                    logoContainer.style.height = '25%';
                }
                
                customLogoImage = null;
                customLogoSize = 25;
                document.getElementById('logoSizeSlider').value = 25;
                document.getElementById('logoSizeValue').textContent = '25';
                
                // V·∫Ω l·∫°i v√≤ng quay
                drawWheel();
                
                alert('‚úÖ ƒê√£ kh√¥i ph·ª•c c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh!');
                toggleSettings();
            }
        }
        
        // T·∫£i c√†i ƒë·∫∑t t·ª´ localStorage khi m·ªü trang
        function loadSettings() {
            const savedTitle = localStorage.getItem('wheelTitle');
            const savedBgImage = localStorage.getItem('wheelBgImage');
            const savedLogo = localStorage.getItem('wheelLogo');
            const savedLogoSize = localStorage.getItem('wheelLogoSize');
            
            if (savedTitle) {
                document.getElementById('mainTitle').textContent = savedTitle;
                document.getElementById('settingsTitle').value = savedTitle;
            }
            
            if (savedBgImage) {
                customBgImage = savedBgImage;
                document.body.style.backgroundImage = `url('${savedBgImage}')`;
            }
            
            if (savedLogo) {
                const logoImg = document.getElementById('centerLogoImg');
                if (logoImg) logoImg.src = savedLogo;
            }
            
            if (savedLogoSize) {
                customLogoSize = parseInt(savedLogoSize);
                const sliderEl = document.getElementById('logoSizeSlider');
                const sizeValueEl = document.getElementById('logoSizeValue');
                const logoContainer = document.getElementById('centerLogoContainer');
                
                if (sliderEl) sliderEl.value = customLogoSize;
                if (sizeValueEl) sizeValueEl.textContent = customLogoSize;
                if (logoContainer) {
                    logoContainer.style.width = customLogoSize + '%';
                    logoContainer.style.height = customLogoSize + '%';
                }
            }
        }
        
        // T·∫£i c√†i ƒë·∫∑t khi trang load
        loadSettings();
        
        drawWheel();
    </script>
</body>
</html>
